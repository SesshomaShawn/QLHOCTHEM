-- Khởi tạo cơ sở dữ liệu
CREATE DATABASE QLHOCTHEM
GO

USE QLHOCTHEM
GO

CREATE TABLE LOPHOC
(
	MALMH CHAR(10) NOT NULL,
	TenLMH NVARCHAR(50),
	NgayBatDau DATE,
	TongSoTiet INT,
	SoTienTiet INT,
	MaGV CHAR(10),
	MaDML CHAR(10),
	MaKhoi CHAR(10)

	PRIMARY KEY (MALMH)
)

CREATE TABLE HOCSINH
(
	MaHS CHAR(10) NOT NULL,
	HoTenHS NVARCHAR(100),
	NgaySinh DATE,
	SDT CHAR(10),
	DiaChi NVARCHAR(50),
	GioiTinh NVARCHAR(10),
	Email VARCHAR(50),
	MatKhau VARCHAR(30)

	PRIMARY KEY(MaHS)
)

CREATE TABLE LICHHOC
(
	MaLichHoc CHAR(10) NOT NULL,
	NgayHoc DATE,
	KipHoc INT,
	SoTiet INT,
	MaLMH CHAR(10),
	MaGV CHAR(10)

	PRIMARY KEY (MaLichHoc)
)

CREATE TABLE GIAOVIEN
(
	MaGV CHAR(10) NOT NULL,
	HoTenGV NVARCHAR(100),
	NgaySinh DATE,
	DiaChi NVARCHAR(50),
	SDT CHAR(10),
	GioiTinh NVARCHAR(10),
	Email VARCHAR(50),
	MatKhau VARCHAR(30),
	MaMH CHAR(10),
	MaDM CHAR(10)

	PRIMARY KEY(MAGV)
)

CREATE TABLE DIEMDANH
(
	MaLichHoc CHAR(10) NOT NULL,
	MaHS CHAR(10) NOT NULL,
	DiemDanh NVARCHAR(10),

	PRIMARY KEY (MaLichHoc, MaHS)
)

CREATE TABLE PHIEULUONG
(
	MaPL CHAR(10) NOT NULL,
	NgayTra DATE,
	TongSoTien BIGINT,
	MaGV CHAR(10)

	PRIMARY KEY (MaPL)
)

CREATE TABLE DINHMUCLUONG
(
	MaDM CHAR(10) NOT NULL,
	LoaiDM NVARCHAR(10),
	SoTien INT,

	PRIMARY KEY (MaDM)
)

CREATE TABLE DINHMUCLOP
(
	MaDML CHAR(10) NOT NULL,
	TrinhDoLop NVARCHAR(20),
	SoTien INT,

	PRIMARY KEY (MaDML)
)

CREATE TABLE MONHOC
(
	MaMH CHAR(10) NOT NULL,
	TenMH NVARCHAR(20),

	PRIMARY KEY (MaMH)
)

CREATE TABLE HOADON
(
	MaHD CHAR(10) NOT NULL,
	NgayNop DATE,
	NgayXuat DATE,
	SoTienNop BIGINT,
	TinhTrang NVARCHAR(10),
	MaHS CHAR(10)

	PRIMARY KEY (MaHD)
)

CREATE TABLE KHOI
(
	MaKhoi CHAR(10) NOT NULL,
	TenKhoi NVARCHAR(20),

	PRIMARY KEY (MaKhoi)
)
GO

--
ALTER TABLE dbo.LOPHOC ADD FOREIGN KEY (MaGV) REFERENCES dbo.GIAOVIEN (MaGV)
ALTER TABLE dbo.LOPHOC ADD FOREIGN KEY (MaDML) REFERENCES dbo.DINHMUCLOP (MaDML)
ALTER TABLE dbo.LOPHOC ADD FOREIGN KEY (MaKhoi) REFERENCES dbo.KHOI (MaKhoi)
GO

ALTER TABLE dbo.LICHHOC ADD FOREIGN KEY (MaLMH) REFERENCES dbo.LOPHOC (MaLMH)
ALTER TABLE dbo.LICHHOC ADD FOREIGN KEY (MaGV) REFERENCES dbo.GIAOVIEN (MaGV)
GO

ALTER TABLE dbo.GIAOVIEN ADD FOREIGN KEY (MaDM) REFERENCES dbo.DINHMUCLUONG (MaDM)
ALTER TABLE dbo.GIAOVIEN ADD FOREIGN KEY (MaMH) REFERENCES dbo.MONHOC (MaMH)
GO

ALTER TABLE dbo.PHIEULUONG ADD FOREIGN KEY (MaGV) REFERENCES dbo.GIAOVIEN (MaGV)
GO

ALTER TABLE dbo.HOADON ADD FOREIGN KEY (MaHS) REFERENCES dbo.HOCSINH (MaHS)
GO

ALTER TABLE dbo.DIEMDANH ADD FOREIGN KEY (MaLichHoc) REFERENCES dbo.LICHHOC (MaLichHoc)
ALTER TABLE dbo.DIEMDANH ADD FOREIGN KEY (MaHS) REFERENCES dbo.HOCSINH (MaHS)
GO
use QLHOCTHEM
go
alter table DINHMUCLUONG
add TrinhDoGV nvarchar(20)
go 
update DINHMUCLUONG
set TrinhDoGV = N'Thạc sĩ'
where MaDM = 'DM01'
go
update DINHMUCLUONG
set TrinhDoGV = N'Tiến sĩ'
where MaDM = 'DM02'
go
update DINHMUCLUONG
set TrinhDoGV = N'Giáo sư'
where MaDM = 'DM03'
